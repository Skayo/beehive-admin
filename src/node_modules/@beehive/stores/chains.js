import api from '@beehive/api';
import { writable } from 'svelte/store';

function createChains() {
	const chains = writable(null, (set) => {
		api.findAll('chains').then(chainRecords => {
			api.findAll('bees').then(beeRecords => {

				for (let i = 0; i < chainRecords.length; i++) {
					for (let j = 0; j < beeRecords.length; j++) {
						if (chainRecords[i].event.Bee === beeRecords[j].id) {
							chainRecords[i].eventBee = beeRecords[j];
						}
					}
				}

				set(chainRecords);

			}).catch(error => {
				console.error(error);
				set(false);
			});
		}).catch(error => {
			console.error(error);
			set(false);
		});
	});

	return {
		subscribe: chains.subscribe,
	};
}

export const chains = createChains();