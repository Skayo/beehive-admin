import { writable } from 'svelte/store';
import api from '@beehive/api';

function createBees() {
	const bees = writable(null, (set) => {
		api.findAll('bees')
		   .then(set)
		   .catch(error => {
			   console.error(error);
			   set(false);
		   });
	});

	return {
		subscribe: bees.subscribe,

		setActive(bee, active) {
			return api.update('bees', bee.id, {
				active,

				description: bee.description,
				options:     bee.options,
			}).then(updatedBee => {
				bees.update($bees => {
					for (let i = 0; i < $bees.length; i++) {
						if ($bees[i].id === bee.id) {
							$bees[i] = updatedBee;
						}
					}

					return $bees;
				});
			}).catch(console.error);
		},

		delete(id) {
			return api.delete('bees', id).then(() => {
				bees.update($bees => $bees.filter(bee => bee.id !== id));
			}).catch(console.error);
		},
	};
}

export const bees = createBees();