<script>
	import { fade } from 'svelte/transition';

	export let initialState = false;
	export let toggleState = () => {
	};
	export let big = false;
	export let onText = 'ON';
	export let offText = 'OFF';
	export let ballColor = '#fff';

	let state = initialState;
	let transitionText = '';
	let changingState = false;

	function setState(newState) {
		changingState = true;

		setTimeout(() => state = newState, 300); // Fire when text gone
		setTimeout(() => {
			changingState = false;
			transitionText = '';
		}, 600); // Fire when ball at end position
	}

	function setText(newText) {
		transitionText = newText;
	}

	function handleClick() {
		toggleState(setState, setText);
	}
</script>

<div class="switch" class:big class:active={state} class:changing-state={changingState} on:click={handleClick}>
	<div class="switch-ball" style="background-color: {ballColor}"></div>
	<div class="switch-text">
		<span class="switch-text-inner">{transitionText || (state ? onText : offText)}</span>
	</div>
</div>

<style>
	.switch {
		@apply w-32 h-8 relative rounded-full bg-black bg-opacity-25 shadow-md cursor-pointer overflow-visible select-none transition-colors duration-300;
	}

	.switch.big {
		@apply w-40 h-10;
	}


	.switch-ball {
		transition-property: left, opacity, background-color;
		@apply w-6 h-6 z-10 top-1 left-1 absolute flex items-center justify-center rounded-full duration-300;
	}

	.switch:hover .switch-ball {
		@apply opacity-75;
	}

	.switch.big .switch-ball {
		@apply h-8 w-8;
	}

	.switch.active .switch-ball {
		@apply left-25;
	}

	.switch.big.active .switch-ball {
		@apply left-31;
	}


	.switch-text {
		@apply z-10 inset-0 absolute flex items-center text-white text-center font-bold text-base;
	}

	.switch.big .switch-text {
		@apply text-lg;
	}

	.switch.active .switch-text {
		@apply justify-end;
	}


	.switch-text-inner {
		@apply w-24 ml-8 opacity-100 transition-opacity duration-300;
	}

	.switch:hover .switch-text-inner {
		@apply opacity-75;
	}

	.switch.big .switch-text-inner {
		@apply w-32 ml-10;
	}

	.switch.changing-state .switch-text-inner {
		@apply opacity-0;
	}

	.switch.active .switch-text-inner {
		@apply ml-0 mr-8;
	}

	.switch.big.active .switch-text-inner {
		@apply mr-10;
	}
</style>